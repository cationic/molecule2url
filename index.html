<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molecule Viewer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            background-color: #f8f9fa;
        }

        .header {
            height: 60px;
            background: white;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            justify-content: space-between;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .brand {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            color: #495057;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 0.95rem;
        }

        .nav-btn:hover {
            background-color: #f1f3f5;
            color: #212529;
        }

        .molecule-select-wrapper {
            position: relative;
        }

        .molecule-select {
            padding: 0.5rem 2rem 0.5rem 1rem;
            font-size: 0.95rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background-color: #f8f9fa;
            color: #495057;
            cursor: pointer;
            outline: none;
            appearance: none;
            -webkit-appearance: none;
            font-family: inherit;
            min-width: 200px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .molecule-select:hover {
            border-color: #adb5bd;
        }

        .molecule-select:focus {
            border-color: #339af0;
            box-shadow: 0 0 0 2px rgba(51, 154, 240, 0.25);
        }

        .select-arrow {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #868e96;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* List View Styles */
        .view-list {
            height: 100%;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tree-view {
            width: 100%;
            /* max-width: 800px; Removed to fill screen */
            background: white;
            border-radius: 12px;
            padding: 1rem 0;
            /* Remove horizontal padding for full-width lines */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
        }

        .tree-row {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #e7f5ff;
            /* Light blue separator */
            transition: background 0.1s;
            color: #495057;
        }

        .tree-row:last-child {
            border-bottom: none;
        }

        .tree-row:hover {
            background: #f8f9fa;
            /* Very subtle hover */
        }

        .tree-indent {
            display: inline-block;
            width: 20px;
            /* Indentation unit */
            flex-shrink: 0;
        }

        .toggle-arrow {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #adb5bd;
            transition: transform 0.2s;
            margin-right: 4px;
            flex-shrink: 0;
        }

        .toggle-arrow svg {
            width: 12px;
            height: 12px;
        }

        .tree-row.open .toggle-arrow {
            transform: rotate(90deg);
        }

        .row-icon {
            margin-right: 8px;
            display: flex;
            align-items: center;
            color: #339af0;
            /* Blue for folders/files */
            flex-shrink: 0;
        }

        .row-name {
            font-weight: 500;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .row-comment {
            font-size: 0.85rem;
            color: #868e96;
            margin-left: 1rem;
        }

        .folder-content {
            display: none;
        }

        .folder-content.show {
            display: block;
        }

        /* Viewer View Styles */
        .view-viewer {
            height: 100%;
            display: none;
            /* Hidden by default */
            padding: 2rem;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: 1px solid #e9ecef;
            display: block;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: white;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-left">
            <a href="#" onclick="showList(); return false;" class="brand">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                    style="color: #339af0;">
                    <path
                        d="M18 9C19.6569 9 21 7.65685 21 6C21 4.34315 19.6569 3 18 3C16.3431 3 15 4.34315 15 6C15 6.12549 15.0077 6.24919 15.0227 6.37063L8.08261 9.84066C7.54305 9.32015 6.80891 9 6 9C4.34315 9 3 10.3431 3 12C3 13.6569 4.34315 15 6 15C6.80891 15 7.54305 14.6798 8.08261 14.1593L15.0227 17.6294C15.0077 17.7508 15 17.8745 15 18C15 19.6569 16.3431 21 18 21C19.6569 21 21 19.6569 21 18C21 16.3431 19.6569 15 18 15C17.1911 15 16.457 15.3202 15.9174 15.8407L8.97733 12.3706C8.99229 12.2492 9 12.1255 9 12C9 11.8745 8.99229 11.7508 8.97733 11.6294L15.9174 8.15934C16.457 8.67985 17.1911 9 18 9Z"
                        fill="currentColor" />
                </svg>
                molecule2url
            </a>

            <button class="nav-btn" onclick="showList()">
                <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
                List Molecules
            </button>

            <div class="molecule-select-wrapper" id="moleculeSelectWrapper">
                <select id="moleculeSelect" class="molecule-select" onchange="if(this.value) loadMolecule(this.value)">
                    <option value="" disabled selected>Select Molecule</option>

                    <option value="HB_test">HB_test</option>

                    <option value="ddfs">ddfs</option>

                    <option value="first-share">first-share</option>

                    <option value="rxn1">rxn1</option>

                    <option value="rxn2">rxn2</option>

                    <option value="test/water">test/water</option>

                    <option value="wittig">wittig</option>

                </select>
                <div class="select-arrow">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
            </div>
        </div>

        <div class="header-right">
            <a href="https://github.com/kangmg/molecule2url" target="_blank" class="nav-btn">
                <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                    </path>
                </svg>
                GitHub
            </a>
        </div>
    </header>

    <div class="main-content">
        <!-- List View -->
        <div id="viewList" class="view-list">
            <div class="tree-view">

                <div class="tree-folder-container">
                    <div class="tree-row" onclick="toggleFolder(this)">
                        <span class="tree-indent" style="width: 0px"></span>
                        <div class="toggle-arrow">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                        </div>
                        <div class="row-icon">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                                <path
                                    d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" />
                            </svg>
                        </div>
                        <span class="row-name">test</span>
                    </div>
                    <div class="folder-content">

                        <div class="tree-row" onclick="selectMolecule('test/water')">
                            <span class="tree-indent" style="width: 24px"></span>
                            <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                            <div class="row-icon">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </div>
                            <span class="row-name">water</span>
                            <span class="row-comment">Test water molecule</span>
                        </div>

                    </div>
                </div>

                <div class="tree-row" onclick="selectMolecule('ddfs')">
                    <span class="tree-indent" style="width: 0px"></span>
                    <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                    <div class="row-icon">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <span class="row-name">ddfs</span>
                    <span class="row-comment">Extracted from viewer.html</span>
                </div>

                <div class="tree-row" onclick="selectMolecule('first-share')">
                    <span class="tree-indent" style="width: 0px"></span>
                    <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                    <div class="row-icon">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <span class="row-name">first-share</span>
                    <span class="row-comment">Extracted from viewer.html</span>
                </div>

                <div class="tree-row" onclick="selectMolecule('HB_test')">
                    <span class="tree-indent" style="width: 0px"></span>
                    <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                    <div class="row-icon">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <span class="row-name">HB_test</span>
                    <span class="row-comment">charge: 0; multiplicity: 1; generated_by: Rowan; timestamp: 2025-11-28
                        00:29:28; name: Step 1;;</span>
                </div>

                <div class="tree-row" onclick="selectMolecule('rxn1')">
                    <span class="tree-indent" style="width: 0px"></span>
                    <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                    <div class="row-icon">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <span class="row-name">rxn1</span>

                </div>

                <div class="tree-row" onclick="selectMolecule('rxn2')">
                    <span class="tree-indent" style="width: 0px"></span>
                    <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                    <div class="row-icon">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <span class="row-name">rxn2</span>

                </div>

                <div class="tree-row" onclick="selectMolecule('wittig')">
                    <span class="tree-indent" style="width: 0px"></span>
                    <div class="toggle-arrow"></div> <!-- Spacer for alignment -->
                    <div class="row-icon">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <span class="row-name">wittig</span>
                    <span class="row-comment">0 1 0.059778</span>
                </div>

            </div>
        </div>

        <!-- Viewer View -->
        <div id="viewViewer" class="view-viewer">
            <iframe id="viewerFrame" title="Molecule Viewer"></iframe>
        </div>
    </div>

    <script>
        const viewList = document.getElementById('viewList');
        const viewViewer = document.getElementById('viewViewer');
        const viewerFrame = document.getElementById('viewerFrame');
        const moleculeSelect = document.getElementById('moleculeSelect');
        const moleculeSelectWrapper = document.getElementById('moleculeSelectWrapper');
        const listButton = document.querySelector('.nav-btn');

        function toggleFolder(row) {
            // The content div is the next sibling of the row div in the container
            const content = row.nextElementSibling;

            if (content.classList.contains('show')) {
                content.classList.remove('show');
                row.classList.remove('open');
            } else {
                content.classList.add('show');
                row.classList.add('open');
            }
        }

        function showList() {
            viewList.style.display = 'flex';
            viewViewer.style.display = 'none';
            // moleculeSelectWrapper.style.display = 'none'; // Keep visible
            // listButton.style.display = 'none'; // Keep visible

            moleculeSelect.value = ""; // Reset selection

            // Only push state if we are not already at root to avoid redundant history entries
            if (window.location.hash) {
                history.pushState(null, '', window.location.pathname);
            }
        }

        function selectMolecule(molName) {
            viewList.style.display = 'none';
            viewViewer.style.display = 'block';
            // moleculeSelectWrapper.style.display = 'block'; // Always visible
            // listButton.style.display = 'flex'; // Always visible

            // Update dropdown
            moleculeSelect.value = molName;

            // Load iframe only if changed
            const targetSrc = 'viewer.html?molecule=' + molName;
            if (viewerFrame.getAttribute('src') !== targetSrc) {
                viewerFrame.src = targetSrc;
            }

            // Update URL hash if different
            if (window.location.hash !== '#' + molName) {
                window.location.hash = molName;
            }
        }

        function loadMolecule(molName) {
            selectMolecule(molName);
        }

        function handleRoute() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                selectMolecule(hash);
            } else {
                showList();
            }
        }

        // Event Listeners
        window.addEventListener('load', handleRoute);
        window.addEventListener('hashchange', handleRoute);
    </script>
</body>

</html>